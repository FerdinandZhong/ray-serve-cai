# Ray Cluster Deployment Jobs Configuration
#
# This configuration defines the job sequence for setting up a Ray cluster on CML:
# 1. git_sync: Pull latest code from repository
# 2. setup_environment: Create Python venv and install Ray
# 3. launch_ray_cluster: Start the Ray cluster with head + workers
#
# Note on Script Entry Points:
# - setup_environment uses Python directly (creates the venv)
# - launch_ray_cluster uses bash wrapper (which activates venv before running Python)
#   This follows CAI best practices and ensures clean virtual environment activation.
# See ../scripts/ directory for wrapper implementations.

jobs:
  git_sync:
    name: "Git Repository Sync"
    script: ".git_sync.py"
    parent_job_key: null
    timeout: 600
    description: "Clone/sync repository from GitHub"

  setup_environment:
    name: "Setup Python Environment"
    script: "cai_integration/setup_environment.py"
    parent_job_key: "git_sync"
    timeout: 1800  # 30 minutes
    description: "Create Python venv and install Ray dependencies"

  launch_ray_cluster:
    name: "Launch Ray Cluster"
    script: "cai_integration/launch_ray_cluster_job.py"
    parent_job_key: "setup_environment"
    timeout: 600
    description: "Start Ray cluster with configured head and worker nodes (calls bash wrapper via Python subprocess)"
